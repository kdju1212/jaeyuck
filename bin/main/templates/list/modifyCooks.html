<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/base}">

<head>
<title>레시피 수정</title>
<link rel="stylesheet" th:href="@{/css/register.css}"
	layout:fragment="styles">
</head>

<body>
	<div layout:fragment="content">
		<h1 class="page-title">레시피 수정</h1>

		<form id="modifyForm" th:action="@{/list/modify}" method="post"
			enctype="multipart/form-data" name="modify_form">
			<input type="hidden" name="recipeId"
				th:value="${recipeInfo.recipeId}" id="recipeId" /> <input
				type="hidden" name="writerId" th:value="${recipeInfo.userid}"
				id="writerId" /> <input type="hidden" name="deleteImageFlag"
				id="deleteImageFlag" value="N"> <input type="hidden"
				name="deletedIngredientIds" id="deletedIngredientIds" value="" /> <input
				type="hidden" name="deletedStepIds" id="deletedStepIds" value="" />


			<div class="form-group">
				<label for="title">레시피 제목</label> <input type="text" id="title"
					name="title" placeholder="예) 된장찌개" th:value="${recipeInfo.title}"
					required>
			</div>

			<div class="form-group">
				<label>요리 완성 사진</label>
				<div class="complete-image-display-section"
					th:if="${not #strings.isEmpty(recipeInfo.completeImgUrl)}">
					<div class="image-preview-container">

						<img th:src="${recipeInfo.completeImgUrl}" alt="현재 완성 이미지"
							class="current-image">
						<button type="button" class="btn-delete-complete-image">이미지
							삭제</button>
					</div>
				</div>
				<input type="hidden" name="currentCompleteImgUrl"
					th:value="${recipeInfo.completeImgUrl != null ? recipeInfo.completeImgUrl : ''}" />

				<div class="initial-upload-section"
					th:style="${not #strings.isEmpty(recipeInfo.completeImgUrl) ? 'display:none;' : 'display:block;'}">
					<input type="file" name="complete_photo" id="complete_photo_upload"
						accept=".jpg,.jpeg,.png,.gif">
				</div>
			</div>

			<div class="form-group">
				<label for="kind">요리 종류</label> <select name="kind" id="kind"
					required>
					<option value="">선택하세요</option>
					<option value="한식" th:selected="${recipeInfo.kind == '한식'}">한식</option>
					<option value="중식" th:selected="${recipeInfo.kind == '중식'}">중식</option>
					<option value="일식" th:selected="${recipeInfo.kind == '일식'}">일식</option>
					<option value="양식" th:selected="${recipeInfo.kind == '양식'}">양식</option>
					<option value="기타" th:selected="${recipeInfo.kind == '기타'}">기타</option>
				</select>
			</div>

			<section>
				<h2>재료</h2>
				<div id="ingredients-container">
					<div th:each="ing, iterStat : ${ingredients}" class="material-row">
						<input type="hidden" name="existingIngredientIds"
							th:value="${ing.ingredientId}" /> <input type="text"
							name="existingIngredientNames" th:value="${ing.name}"
							placeholder="재료명" required> <input type="text"
							name="existingIngredientAmounts" th:value="${ing.amount}"
							placeholder="수량 (예: 100g)" required>
						<button type="button" class="remove-button"
							onclick="removeRow(this)">-</button>
					</div>
				</div>
				<button type="button" id="add-ingredient-btn" class="add-button">+
					재료 추가</button>
			</section>

			<section>
				<h2>요리 순서</h2>
				<div id="steps-container">
					<div th:each="step, iterStat : ${steps}" class="step-item">
						<input type="hidden" name="existingStepIds"
							th:value="${step.stepId}" /> <label
							th:text="'Step ' + (${iterStat.index} + 1)"></label>
						<textarea name="existingStepDescriptions"
							th:text="${step.description}" placeholder="예) 양파를 썰어주세요."
							required></textarea>

						<input type="hidden" name="existingStepCurrentImgUrls"
							th:value="${step.stepImgUrl}" /> <input type="hidden"
							name="existingStepDeleteImageFlags" value="N"
							class="step-delete-image-flag" />

						<div class="step-image-container">
							<div class="current-step-image-display"
								th:style="${not #strings.isEmpty(step.stepImgUrl) ? 'display:block;' : 'display:none;'}">
								<img th:src="${step.stepImgUrl}" alt="단계 이미지"
									class="current-step-image"
									style="max-width: 100px; height: auto; display: block; margin-bottom: 5px;" />
								<button type="button" class="btn-delete-step-image"
									th:data-step-id="${step.stepId}">이미지 삭제</button>
							</div>

							<div class="new-step-image-upload-section"
								th:style="${not #strings.isEmpty(step.stepImgUrl) ? 'display:none;' : 'display:block;'}">
								<label>단계 이미지 업로드 (선택)</label> <input type="file"
									name="step_photo" accept=".jpg,.jpeg,.png,.gif">
							</div>
						</div>
						<button type="button" class="remove-button btn-remove-step">-</button>
					</div>
				</div>
				<button type="button" id="add-step-btn" class="add-button">+
					요리 순서 추가</button>
			</section>

			<section>
				<h2>요리 팁 / 주의사항</h2>
				<textarea name="tip" placeholder="예) 소금보다 설탕을 먼저 넣어야 육질이 부드러워요."
					rows="5" style="width: 100%; resize: none;"
					th:text="${recipeInfo.tip}"></textarea>
			</section>

			<div class="regi2_btn3">
				<div class="regi2_btn3_in">
					<a href="javascript:void(0);" onclick="history.back();"
						class="regi2_btn3_cancel">작성취소</a>
				</div>

				<div class="regi2_btn3_in">
					<a href="javascript:void(0);" onclick="doSubmit('update')"
						class="regi2_btn3_save">수정하기</a>
				</div>
			</div>
		</form>

		<script th:src="@{/js/modify.js}" layout:fragment="scripts"></script>
	</div>
</body>
</html>